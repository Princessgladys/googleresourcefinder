{% comment %}
# Copyright 2009-2010 by Ka-Ping Yee
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
{% endcomment %}

{% extends "base.html" %}
{% load i18n %}

{% comment %}
# Title, home, and print link blocks left in for potential overrides in
# other files.
# TODO(pfritzsche): Figure out why the blocks are necessary; according
# kpy, they should not be necessary for overriding grandparents of a file.
{% endcomment %}

{% block home-link %}
{{block.super}}
{% endblock home-link %}

{% block print-link %}
{{block.super}}
{% endblock print-link %}

{% block title %}
{{block.super}}
{% endblock title %}

{% block stylesheets %}
  <link rel="stylesheet" href="static/map.css">
  <!--[if lt IE 8]>
    <link rel="stylesheet" href="static/map-ie.css">
  <![endif]-->
  {% if params.lang_bidi %}
    <link rel="stylesheet" href="static/map-rtl.css">
  {% endif %}

  <link rel="stylesheet" type="text/css" media="all"
        href="static/css/custom-theme/jquery-ui-1.8rc3.custom.css">
  <link rel="stylesheet" href="static/bubble.css">
{% endblock stylesheets %}

{% block javascript-includes %}
  <script type="text/javascript" src="static/map.js"></script>
  <script type="text/javascript" src="static/bubble.js"></script>
  <script type="text/javascript" src="static/edit.js"></script>
  <script type="text/javascript">
    var is_logged_in = {% if user %} true {% else %} false {% endif %};
    var print = {% if params.print %} true {% else %} false {% endif %};
    var print_url = '{{print_url}}';
    var bubble_url = '{{bubble_url}}';
    var edit_url_template = '{{edit_url_template}}';
    var rtl = {% if params.lang_bidi %} true {% else %} false {% endif %};
  </script>

  <!-- Google Maps API -->
  <script type="text/javascript"
      src="http://maps.google.com/maps/api/js?sensor=false&language={{params.maps_lang}}">
  </script>
  <script type="text/javascript"
      src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer_compiled.js">
  </script>

{% endblock javascript-includes %}

{% comment %}
# Include block for potential overrides
{% endcomment %}
{% block language-select %}
{{block.super}}
{% endblock language-select %}

{% block content %}
<div id="map"></div>
<div class="hshadow hs1"></div>
<div class="hshadow hs2"></div>
<div class="hshadow hs3"></div>
<div class="vshadow vs1"></div>
<div class="vshadow vs2"></div>
<div class="vshadow vs3"></div>

{% block print-summary %}
{% endblock print-summary %}

<div id="data">
{% block data %}
<div id="supply-section" class="section">
  <div class="table-head">
    <table width="100%" cellspacing=0 cellpadding=0 border=0>
      <thead id="supply-thead">
        <tr>
          {% comment %}
          #i18n: Header for a list of provisions
          {% endcomment %}
          <th>{% trans "Supplies" %}</th>
        </tr>
      </thead>
    </table>
  </div>
  <div class="table-body">
    <table width="100%" cellspacing=0 cellpadding=0 border=0>
      <tbody id="supply-tbody"></tbody>
    </table>
  </div>
</div>
<div id="filter-section" class="section">
  <div class="table-head">
    <table width="100%" cellspacing=0 cellpadding=0 border=0>
      <thead id="filter-thead">
        <tr>
          {% comment %}
          #i18n: Header for a list of filters to restrict a list of data being
          #i18n: viewed.
          {% endcomment %}
          <th>{% trans "Filters" %}</th>
        </tr>
      </thead>
    </table>
  </div>
  <div class="table-body">
    <table width="100%" cellspacing=0 cellpadding=0 border=0>
      <tbody id="filter-tbody"></tbody>
    </table>
  </div>
</div>
<div id="legend-section" class="section">
  <div class="table-body">
    <table width="100%" cellspacing=0 cellpadding=0 border=0>
      <tbody id="legend-tbody"></tbody>
    </table>
  </div>
</div>
<div id="division-section" class="section">
  <div class="table-head">
    <table width="100%" cellspacing=0 cellpadding=0 border=0>
      <thead id="division-thead">
        <tr>
          {% comment %}
          #i18n: Meaning: administrative division
          {% endcomment %}
          <th>{% trans "District" %}</th>
        </tr>
      </thead>
    </table>
  </div>
  <div class="table-body" id="division-list">
    <table width="100%" cellspacing=0 cellpadding=0 border=0>
      <tbody id="division-tbody"></tbody>
    </table>
  </div>
</div>
<div id="subject-section" class="section">
  <div class="table-head">
    <table width="100%" cellspacing=0 cellpadding=0 border=0>
      <thead id="subject-thead">
        <tr>
          {% comment %}
          #i18n: A place that provides a particular service
          {% endcomment %}
          <th>{% trans "Facility" %}</th>
        </tr>
      </thead>
    </table>
  </div>
  <div class="table-body" id="subject-list">
    <table width="100%" cellspacing=0 cellpadding=0 border=0>
      <tbody id="subject-tbody">
      </tbody>
    </table>
  </div>
</div>
{% endblock data %}
</div>

{% block freshness %}
<div id="freshness">
  <span id="freshness-text"></span>
  <div>
    {% comment %}
    #i18n: Button to export data to comma-separated-values format.
    {% endcomment %}
    <a target="_blank" href="{{export_url}}" onclick="_gaq.push(['_trackEvent', 'outbound', 'export', this.href])">{% trans "Export CSV" %}</a> <span class="sep">|</span>

    {% comment %}
    #i18n: Link to go to a page with past versions of the 'master' list
    {% endcomment %}
    <a target="_blank" href="http://sites.google.com/a/netspective.org/haiti-health-facilities/files" onclick="_gaq.push(['_trackEvent', 'outbound', 'masterlist', this.href])">{% trans "View Master List archive" %}</a>
  </div>
</div>
{% endblock freshness %}

{% block footer %}
{% endblock footer %}
<div id="edit-data" style="display:none"></div>
<script>
  jQuery(document).ready(function() {
    load_data({{data}}, '{{params.subject_name}}');
    {% if params.embed and user %}
      {% comment %}
        We get here if redirected from the 'Sign-in to edit' link in the bubble
        through the sign-in form. Need to check if the user exists to prevent
        strange behavior when copy/pasting a link with embed=yes to a browser
        that is not yet signed in.

        TODO(shakusa) Proper escaping of params.subject_name. |escape won't
        work if params.subject_name has an ampersand
      {% endcomment %}     
      inplace_edit_start(make_edit_url('{{params.subject_name|escape}}'));
    {% endif %}
  });
</script>
</body>
</html>
{% endblock content %}
