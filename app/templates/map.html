{% comment %}
# Copyright 2009-2010 by Ka-Ping Yee
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
{% endcomment %}

{% extends "base.html" %}
{% load i18n %}

{% comment %}
# Title, home, and print link blocks left in for potential overrides in
# other files.
# TODO(pfritzsche): Figure out why the blocks are necessary; according
# kpy, they should not be necessary for overriding grandparents of a file.
{% endcomment %}

{% block home-link %}
{{block.super}}
{% endblock home-link %}

{% block print-link %}
{{block.super}}
{% endblock print-link %}

{% block title %}
{{block.super}}
{% endblock title %}

{% block stylesheets %}
  <link rel="stylesheet" href="static/map.css">
  <!--[if lt IE 8]>
    <link rel="stylesheet" href="static/map-ie.css">
  <![endif]-->
  <link rel="stylesheet" type="text/css" media="all"
        href="static/css/custom-theme/jquery-ui-1.8rc3.custom.css">
  <link rel="stylesheet" href="static/bubble.css">
{% endblock stylesheets %}

{% block javascript-includes %}
  <script type="text/javascript" src="static/map.js"></script>
  <script type="text/javascript" src="static/edit.js"></script>
  <script type="text/javascript">
    var print = {% if params.print %} true {% else %} false {% endif %};
    var print_url = '{{print_url}}';
    var bubble_url = '{{bubble_url}}';
  </script>
  
  <!-- Google Maps API -->
  <script type="text/javascript"
      src="http://maps.google.com/maps/api/js?sensor=false&language={{params.maps_lang}}">
  </script>
  <script type="text/javascript"
      src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer_compiled.js">
  </script>
{% endblock javascript-includes %}

{% comment %}
# Include block for potential overrides
{% endcomment %}
{% block language-select %}
{{block.super}}
{% endblock language-select %}

{% block content %}
<div id="map"></div>
<div class="hshadow hs1"></div>
<div class="hshadow hs2"></div>
<div class="hshadow hs3"></div>
<div class="vshadow vs1"></div>
<div class="vshadow vs2"></div>
<div class="vshadow vs3"></div>

{% block print-summary %}
{% endblock print-summary %}

<div id="data">
{% block data %}
  {% include "data.html" %}
{% endblock data %}
</div>

{% block freshness %}
<div id="freshness">
  <span id="freshness-text"></span>
  <div>
    {% comment %}
    #i18n: Button to export data to comma-separated-values format.
    {% endcomment %}
    <a target="_blank" href="{{export_url}}" onclick="_gaq.push(['_trackEvent', 'outbound', 'export', this.href])">{% trans "Export CSV" %}</a> <span class="sep">|</span>

    {% comment %}
    #i18n: Link to go to a page with past versions of the 'master' list
    {% endcomment %}
    <a target="_blank" href="http://sites.google.com/a/netspective.org/haiti-health-facilities/files" onclick="_gaq.push(['_trackEvent', 'outbound', 'masterlist', this.href])">{% trans "View Master List archive" %}</a>
  </div>
</div>
{% endblock freshness %}

{% block footer %}
{% endblock footer %}
<div id="edit-data" style="display:none"></div>
<script>
  jQuery(document).ready(function() {
    load_data({{data}}, '{{params.subject_name}}');
    {% if params.embed and user %}
      {% comment %}
        We get here if redirected from the 'Sign-in to edit' link in the bubble
        through the sign-in form. Need to check if the user exists to prevent
        strange behavior when copy/pasting a link with embed=yes to a browser
        that is not yet signed in.
      {% endcomment %}
      
      inplace_edit_handler('{{edit_url|escape}}');
    {% endif %}
  });
</script>
</body>
</html>
{% endblock content %}
